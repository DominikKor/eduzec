{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Page</title>
    <!-- Animate CSS -->
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
    <!-- Bootstrap 4 -->
    <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}" />
    <!-- Fonts and Icons I stole from the internet lol-->
    <link rel="stylesheet" href="{% static 'fa4/css/font-awesome.min.css' %}" />
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{% url "app:landing" %}">Eduzec</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <form class='ml-auto'>
                    <div class='input-group'>
                        <button class="btn btn-dark px-3" type="submit">Ask</button>
                        <div class="input-group-append">
                        <input type="text" name="q" class="form-control" placeholder="Search" />
                        <div class="input-group-append">
                        <button class="btn btn-dark px-2" type="submit">Search</button>
                        </div>
                    </div>
                </form>
                <ul class="navbar-nav ml-auto">
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'app:dashboard' %}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'login' %}">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'app:register' %}">Register</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    <!-- Question mmmm lol-->
    <div class='container'>
        <h2 class='my-4'>{{quest.title}}</h2>
        <p>
            <span class='mr-2'>{{quest.add_time|date:'d/m/y'}}</span>
            <text>by</text>
            <a href='#' class='ml-2'>{{quest.user.username}}</a>
        </p>
        <p>
            tags:
            {% for tags in tags %}
            <a href='#' class='badge badge-secondary p-1'>{{tags}}</a>
            {% endfor %}
        </p>
        <hr/>
        <div class='row'>
            <div class='col-1'>
                <div class='upvote'>
                    <strong>123</strong><br/>
                    <span class='text-success'>
                    <i class="fa fa-chevron-up fa-2x"></i>
                    </span>
                </div>
                <div class='downvote mt-2'>
                    <span class='text-danger'>
                    <i class="fa fa-chevron-down fa-2x"></i>
                    </span><br/>
                    <strong>123</strong>
                </div>
            </div>
            <div class='col-11'>
                <p class='mt-3'>
                    {{quest.detail}}
                </p>
            </div>
            <div class='col-1'>
                <div class='upvote'>
                    <strong>123</strong><br/>
                    <span class='text-success'>
                    <i class="fa fa-chevron-up fa-2x"></i>
                    </span>
                </div>
                <div class='downvote mt-2'>
                    <span class='text-danger'>
                    <i class="fa fa-chevron-down fa-2x"></i>
                    </span><br/>
                    <strong>123</strong>
                </div>
            </div>
            <div class='col-11'>
                <p class='mt-1'>
                    {{answer.detail}}
                </p>
                <hr/>
                <p>
                    <span class='mr-2'>{{answer.add_time|date:'d/m/y'}}</span>
                    <text>by</text>
                    <a href='#' class='mr-2'>{{ answer.user }}</a>
                    <span>5 comments</span>
                </p>
                {% if user.is_authenticated %}
                <!-- Comment Section Form -->
                <div class='card'>
                    <h6 class='card-header'>Comment</h6>
                    <div class='card-body'>
                        <textarea class='form-control comment-text'></textarea>
                        <button type='button' data-answer='{{answer.id}}' class='btn btn-dark my-3 save-comment'>Comment</button>
                    </div>
                </div>
                {% endif %}
                <!--Comment Section Start-->
                <div class='comment-wrapper'>
                    {% for comment in comments %}
                    <div class='card'>
                        <div class='card-body'>
                            <p><a href='#'>{{ comment.user }}</a><text> - </text>{{ comment.comment }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
<script src='{% static 'jquery-3.5.1.min.js' %}'></script>
<script>
    $(document).ready(function(){
        $('.save-comment').on('click',function(){
            var _comment=$('.comment-text').val();
            var _answerid=$(this).data('answer');
            // Ajax starts here i guess
            $.ajax({
                url:'/save-comment',
                type:'post',
                data:{
                    comment:_comment,
                    answerid:_answerid,
                    csrfmiddlewaretoken:'{{csrf_token}}',
                },
                dataType:'json',
                beforeSend:function(){
                    $('.save-comment').addClass('disabled').text('saving...');
                },
                success:function(res){
                    if(res.bool==true){
                        //$('.comment-text').val('');
                        // Append Element or somethin
                        var _html="<div class='card animate__animated animate__fadeInDown'>\
                            <div class='card-body'>\
                                <p><a href='#'>{{ request.user }}</a><text> - </text>" + _comment + "</p>\
                            </div>\
                        </div>";
                        $('.comment-wrapper').append(_html);
                    }
                    $('.save-comment').removeClass('disabled').text('Comment');
                }
            });
        });
    });
</script>
</body>
</html>